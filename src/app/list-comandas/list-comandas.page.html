<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button autoHide="false"></ion-menu-button>
    </ion-buttons>
    <ion-title>Comandas</ion-title>    
  </ion-toolbar>
</ion-header>



<ion-content class="ion-padding" style="margin-top: 50px;">  
  <ion-list lines="none">     
    <div *ngFor="let item of items">
      
      
      <div *ngIf="!item.isPedido">
        <ion-item-sliding   class="item-card ion-padding" >    
        
          <h3>Comanda</h3>  
          realizado: {{item.createdAt | date:'hh:mm aaa dd/MM/yyyy'}}
          <ion-item >  
            
            <ion-label text-wrap>
              Pedido por: {{item.empleado_email}} <span *ngIf="item.cliente_nombre">para {{item.cliente_nombre}}</span><br>                           
                <ion-item *ngFor="let producto of item.carrito.productos; let i = index">
                  <ion-avatar slot="start">
                    <img src="{{producto.foto}}" *ngIf="producto.foto">
                    <ion-icon name="cube" *ngIf="!producto.foto"></ion-icon>
                  </ion-avatar>
                  <ion-label>
                    <h2>{{producto.nombre}}</h2>
                    <h3><b>{{producto.descripcion_venta}}</b></h3>
                    <h3>cantidad :{{producto.cantidad}} {{producto.unidad}} </h3>
                    <h3>{{producto.precio * producto.cantidad | currency}}</h3><br><br>
                  </ion-label>            
                </ion-item> 
                <ion-item *ngFor="let servicio of item.carrito.servicios; let i = index">
                  <ion-avatar slot="start">
                    <img src="{{servicio.foto}}" *ngIf="servicio.foto">
                    <ion-icon name="document-attach-outline" *ngIf="!servicio.foto"></ion-icon>
                  </ion-avatar>
                  <ion-label text-wrap>
                    <h2>{{servicio.nombre}}</h2>
                    <h3>{{servicio.plan.nombre}}, 
                      <span *ngIf="servicio.plan.tipo == 'dias'">{{servicio.plan.dias}} días por </span>
                      <span *ngIf="servicio.plan.tipo == 'mensual'">el mes por </span>
                      <span *ngIf="servicio.plan.tipo == 'anual'">el año por </span>
                      {{servicio.plan.precio | currency}}
                    </h3>
                    <h3>{{servicio.descripcion_venta}}</h3>
                    <h3 *ngIf="servicio.pagoAdelantado == 'false'" style="color:red">El abono se pagará al finalizar el periodo</h3>
                  </ion-label>  
                </ion-item>                
            </ion-label>   
            
          </ion-item>
          <ion-item>
      
            <ion-button *ngIf="item.status == 0" size="large" slot="end" (click)="comandaTomada(item)"  expand="block">Tomado</ion-button>   
            <ion-button *ngIf="item.status == 1" size="large" slot="end" (click)="comandaLista(item)"  expand="block">Listo!</ion-button>  
            <ion-button *ngIf="item.status == 2" color="danger" size="large" slot="end" (click)="cobrarComanda(item)"  expand="block">Cobrar</ion-button>          
          </ion-item>
          <ion-item-options side="end">
            <ion-item-option color="danger" (click)="eliminar(item)"><ion-icon name="trash" ></ion-icon> Eliminar</ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      </div>
      <ion-card class="ion-padding" *ngIf="item.isPedido">

        <h3>Pedido</h3>
        realizado: {{item.createdAt | date:'hh:mm aaa dd/MM/yyyy'}}
      
      
        <ion-list-header>
          Productos
        </ion-list-header> 
          
                          
        <ion-item *ngFor="let producto of item.productos; let p = index">
          <ion-avatar slot="start">
            <img src="{{producto.icon}}" *ngIf="producto.icon">
            <ion-icon name="star" *ngIf="!producto.icon"></ion-icon>
          </ion-avatar>
          <ion-label>
            <h2>{{producto.nombre}}</h2>
            <h3>{{producto.comentario}}</h3>
            <h3>{{producto.cantidad}} X {{producto.precio * producto.cantidad | currency}}</h3>         
          </ion-label>          
        </ion-item>
        <ion-item  *ngIf="rol == 'cadete'">
          Para: {{item.clienteNombre}}<br>
          Telefono:{{item.clienteTelefono}}<br>
          Direccion: {{item.clienteDireccion}}<br>
          
        </ion-item>
        <ion-item *ngIf="rol == 'cadete' && item.piso != ''">
          Piso:{{item.clientePiso}} <br>
          Puerta:{{item.clientePuerta}}
        </ion-item>
        <h5>Total: {{item.total | currency}} + <b>Costo de envio</b></h5>        

        <ion-item *ngIf="item.estado == '0' && (rol == 'owner' || rol == 'comandatario')">
          <ion-button size="large" class="btn-footer-agregar" color="primary" slot="end" (click)="pedidoTomado(item)">Tomado</ion-button>
        </ion-item>
        <ion-item *ngIf="item.estado == '1' && (rol == 'owner' || rol == 'comandatario')">
          <ion-button size="large" class="btn-footer-agregar" color="danger" slot="start" (click)="pedidoCancelado(item)">Cancelado</ion-button>
          <ion-button size="large" class="btn-footer-agregar" color="success" slot="end" (click)="pedidoListo(item)">Listo!</ion-button>
        </ion-item>
        <ion-item *ngIf="item.estado == '2' && (rol == 'owner' || rol == 'comandatario')">
          <ion-button size="large" class="btn-footer-agregar" color="danger" slot="start" (click)="pedidoCancelado(item)">Cancelado</ion-button>
          <ion-button size="large" class="btn-footer-agregar" color="danger" slot="end" (click)="cobrarPedido(item)">Cobrar</ion-button>
        </ion-item>
        <ion-item *ngIf="item.estado == '3' && (rol == 'owner' || rol == 'comandatario')">
          <ion-button size="large" class="btn-footer-agregar" color="success" slot="end" (click)="noMostrar(item)">Ocultar</ion-button>
        </ion-item>
       
      </ion-card>
    </div>
  </ion-list>
</ion-content>
